<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sluta Snusa</title>
<style>
:root {
  --bg: #f9f7f6;
  --primary: #a1cfff;
  --accent: #ffb7b2;
  --success: #b4f8c8;
  --card: #ffffff;
  --text: #333333;
  --muted: #555555;
}

* { box-sizing:border-box; margin:0; padding:0; font-family:'Arial',sans-serif; }
html, body { height:100%; }
body { background: var(--bg); display:flex; flex-direction:column; }

header {
  background: var(--primary);
  color:#fff;
  padding: 30px;
  text-align:center;
  font-size:32px;
  font-weight:bold;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

main { flex:1; display:flex; justify-content:center; align-items:flex-start; padding:20px; }
.container { width:100%; max-width:700px; display:flex; flex-direction:column; gap:20px; }

.card {
  background: var(--card);
  border-radius:20px;
  padding:20px;
  box-shadow:0 6px 15px rgba(0,0,0,0.05);
  transition: transform 0.2s;
}
.card:hover { transform: translateY(-3px); }

h2 { color: var(--accent); margin-bottom:10px; }

.stat { display:flex; justify-content:space-between; padding:15px; background: var(--success); border-radius:12px; font-size:18px; font-weight:bold; margin-bottom:10px; }

label { display:block; margin-top:10px; margin-bottom:4px; color: var(--muted); }
input[type="date"], input[type="number"] { width:100%; padding:10px; border-radius:10px; border:1px solid #ddd; font-size:14px; }

.btn { display:inline-block; padding:12px 20px; border:none; border-radius:12px; background: var(--accent); color:#fff; font-weight:bold; cursor:pointer; margin-top:10px; transition:opacity 0.2s; }
.btn:hover { opacity:0.9; }

.mood-grid { display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
.mood-btn { flex:1; padding:14px; font-size:20px; border-radius:12px; border:none; cursor:pointer; transition: transform 0.2s; }
.mood-btn:hover { transform: scale(1.1); }

.mile { display:inline-block; margin:4px; padding:6px 12px; border-radius:12px; background:#eee; font-size:13px; }
.mile.done { background: var(--success); font-weight:bold; animation: pop 0.5s ease; }

canvas { width:100%; height:250px; border-radius:12px; background:#fff; margin-top:10px; }

footer { text-align:center; padding:15px; font-size:13px; color: var(--muted); background: #fff; box-shadow:0 -2px 8px rgba(0,0,0,0.05); border-top-left-radius:20px; border-top-right-radius:20px; }

@keyframes pop {
  0% { transform: scale(1); color: var(--text); }
  50% { transform: scale(1.3); color: var(--accent); }
  100% { transform: scale(1); color: var(--text); }
}

.stat span.animate { animation: pop 0.5s ease; }

@media (max-width:500px){ .card{padding:15px;} }
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>Sluta Snusa</header>

<main>
  <div class="container">

    <div class="card">
      <h2>Din statistik</h2>
      <div class="stat">Dagar utan snus: <span id="daysText">0</span></div>
      <div class="stat">Pengar sparade: <span id="moneyText">0</span> kr</div>
      <div class="stat">Nuvarande fas: <span id="stageText">‚Äî</span></div>
    </div>

    <div class="card">
      <h2>Inst√§llningar</h2>
      <label for="quitDate">Datum du slutade/planerar att sluta</label>
      <input type="date" id="quitDate">

      <label for="cansPerWeek">Burkar / vecka</label>
      <input type="number" id="cansPerWeek" value="7">

      <label for="costPerCan">Kostnad / burk (kr)</label>
      <input type="number" id="costPerCan" value="60">

      <button class="btn" id="savePrefs">Spara</button>
    </div>

    <div class="card">
      <h2>Hum√∂r idag</h2>
      <div class="mood-grid">
        <button class="mood-btn" data-mood="1">üò¢</button>
        <button class="mood-btn" data-mood="2">üòï</button>
        <button class="mood-btn" data-mood="3">üòê</button>
        <button class="mood-btn" data-mood="4">üôÇ</button>
        <button class="mood-btn" data-mood="5">üòÑ</button>
      </div>
      <div id="moodSaved" style="margin-top:6px; font-size:13px; color:var(--muted);"></div>
    </div>

    <div class="card">
      <h2>Milstolpar</h2>
      <div id="milestones"></div>
    </div>

    <div class="card">
      <h2>Progress</h2>
      <canvas id="chart"></canvas>
    </div>

  </div>
</main>

<footer>Appen √§r helt gratis och lagrar data lokalt i din webbl√§sare.</footer>

<script>
let state = {prefs:{quitDate:null,cansPerWeek:7,costPerCan:60}, moods:{}};
const STORAGE_KEY='sluta_snusa_pro';
if(localStorage.getItem(STORAGE_KEY)){ state = JSON.parse(localStorage.getItem(STORAGE_KEY)); }

const quitDateInput = document.getElementById('quitDate');
const cansInput = document.getElementById('cansPerWeek');
const costInput = document.getElementById('costPerCan');
const saveBtn = document.getElementById('savePrefs');
const daysText = document.getElementById('daysText');
const moneyText = document.getElementById('moneyText');
const stageText = document.getElementById('stageText');
const moodSaved = document.getElementById('moodSaved');
const milestonesDiv = document.getElementById('milestones');
const moodButtons = document.querySelectorAll('.mood-btn');
const ctx = document.getElementById('chart').getContext('2d');
let chart;

function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function daysBetween(dateStr){ if(!dateStr) return 0; const diff = new Date()-new Date(dateStr); return Math.floor(diff/86400000); }
function computeMoneySaved(days){ return Math.round(days*(state.prefs.cansPerWeek*state.prefs.costPerCan/7)); }
function stageForDays(d){ if(d<=3)return'Akut';if(d<=14)return'Stabilisering';if(d<=30)return'Vana bryts';if(d<=90)return'F√∂rb√§ttring';return'L√•ngsiktig'; }
const MILESTONES=[{label:'1 dag',days:1},{label:'2 dagar',days:2},{label:'1 vecka',days:7},{label:'1 m√•nad',days:30},{label:'3 m√•nader',days:90},{label:'6 m√•nader',days:180},{label:'1 √•r',days:365}];

function animateValue(el) {
  el.classList.remove('animate');
  void el.offsetWidth;
  el.classList.add('animate');
}

function updateAll(){
  const days = daysBetween(state.prefs.quitDate);
  daysText.textContent = days; animateValue(daysText);
  moneyText.textContent = computeMoneySaved(days); animateValue(moneyText);
  stageText.textContent = stageForDays(days);

  milestonesDiv.innerHTML='';
  MILESTONES.forEach(m=>{
    const el=document.createElement('span');
    el.className='mile'+(days>=m.days?' done':'');
    el.textContent=m.label;
    milestonesDiv.appendChild(el);
  });

  saveState();
  updateChart();
}

saveBtn.addEventListener('click',()=>{
  state.prefs.quitDate=quitDateInput.value||null;
  state.prefs.cansPerWeek=Number(cansInput.value)||0;
  state.prefs.costPerCan=Number(costInput.value)||0;
  updateAll();
});

moodButtons.forEach(btn=>{
  btn.addEventListener('click',()=>{
    const mood=btn.dataset.mood;
    const today=new Date().toISOString().slice(0,10);
    state.moods[today]=mood;
    moodSaved.textContent='Hum√∂r sparat f√∂r '+today;
    saveState();
    updateAll();
  });
});

if(state.prefs.quitDate) quitDateInput.value=state.prefs.quitDate;
updateAll();

// ------------------- INTERAKTIV CHART -------------------
function updateChart(){
  if(!state.prefs.quitDate) return;

  const labels = [];
  const moneyData = [];
  const moodData = [];
  const moodEmojis = [];
  const startDate = new Date(state.prefs.quitDate);
  const today = new Date();

  for(let d = new Date(startDate); d <= today; d.setDate(d.getDate()+1)){
    const dateStr = d.toISOString().slice(0,10);
    labels.push(dateStr);
    moneyData.push(computeMoneySaved(daysBetween(state.prefs.quitDate)));
    const moodValue = state.moods[dateStr]?Number(state.moods[dateStr]):null;
    moodData.push(moodValue);
    switch(moodValue){
      case 1: moodEmojis.push('üò¢'); break;
      case 2: moodEmojis.push('üòï'); break;
      case 3: moodEmojis.push('üòê'); break;
      case 4: moodEmojis.push('üôÇ'); break;
      case 5: moodEmojis.push('üòÑ'); break;
      default: moodEmojis.push('');
    }
  }

  if(chart) chart.destroy();

  chart = new Chart(ctx,{
    type:'line',
    data:{
      labels: labels,
      datasets:[
        { 
          label:'Pengar sparade (kr)', 
          data:moneyData, 
          borderColor:'rgba(165,207,255,1)', 
          backgroundColor:'rgba(165,207,255,0.3)', 
          yAxisID:'y',
          tension:0.3,
          fill:true,
          pointRadius:4,
          pointHoverRadius:6
        },
        { 
          label:'Hum√∂r', 
          data:moodData, 
          borderColor:'rgba(255,183,178,1)', 
          backgroundColor:'rgba(255,183,178,0.3)', 
          yAxisID:'y1', 
          spanGaps:true,
          tension:0.3,
          fill:true,
          pointRadius:6,
          pointHoverRadius:8,
          pointStyle: moodEmojis
        }
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:'nearest',intersect:false},
      stacked:false,
      animation:{duration:1000,easing:'easeOutQuart'},
      plugins:{
        tooltip:{
          callbacks:{
            label: function(context){
              if(context.dataset.label === 'Hum√∂r'){
                return 'Hum√∂r: '+moodEmojis[context.dataIndex];
              } else {
                return 'Pengar: '+context.formattedValue+' kr';
              }
            }
          }
        }
      },
      scales:{
        y:{type:'linear',position:'left',title:{display:true,text:'Pengar (kr)'}},
        y1:{type:'linear',position:'right',min:0,max:5,title:{display:true,text:'Hum√∂r (1-5)'}}
      }
    }
  });
}
</script>

</body>
</html>
